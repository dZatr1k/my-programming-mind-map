Метод ферма - это алгоритм факторизации.
Метод ферма был придуман вместо метода пробных делителей, поскольку пробные делители в случае увеличения числа увеличивается количество делений, что пагубно сказывается на производительности алгоритма. Метод ферма использует только операции умножения и сложения.

Метод Ферма приводит число не к каноническому разложению, а к произведению двух чисел, которые не факт, что являются простыми. Для приведения числа к каноническому виду метод Ферма следует применять рекурсивно.

Пусть мы ищем разложение числа $a$. Для простоты работы с ним будем считать, что оно нечётное. В ином случае можно вынести степени двойки из этого числа и привести его к нечётному. Будем искать представление $a$ в виде:
$$
a = x^2-y^2=(x-y)(x+y)
$$
Введём обозначение:
$$
R(x, y)=(x-y)(x+y)-a
$$
Далее поочерёдно будем увеличивать $x, y$ на 1, чтобы вывести $R(x,y)=0$. Отсюда
$$
\displaylines{
R(x+1,y)=(x-y+1)(x+y+1)-a=R(x,y)+2x+1\\
R(x,y+1)=(x-y-1)(x+y+1)-a=R(x,y)-(2y+1)
}
$$
Введём обозначения $R_x=2x+1$ и $R_y=2y+1$, тогда
$$
\displaylines{
R(x+1,y)=R(x,y)+R_x\\
R(x,y+1)=R(x,y)-R_y
}
$$
Если продолжать увеличивать поочерёдно $x, y$ на 1, то $R_x, R_y$ будут увеличиваться на 2.
Как только мы придём к выражению R(x,y)=0, мы сможем высчитать разложение $a$
$$
a=\frac{R_x-R_y}{2}\left(\frac{R_x+R_y}{2} - 1\right)
$$
Причём обычно выбирается $x=h, y=0$, где $h$ - оценка целой части корня числа $a$
$$
h^2\le a \le (h-1)^2
$$
Для определения того, когда нужно прибавлять 1 к $x$ или $y$ производится оценка значения функции. Если оно положительно, то делаем $y+1$, иначе $x+1$.
```python
def factorize(n):
	h = int(sqrt(n))
	x = h
	y = 0
	Rx = 2*h + 1
	Ry = 1
	Rxy = h ** 2 - n
	while Rxy != 0:
		if Rxy > 0:
			Rxy -= Ry
			Ry += 2
		else:
			Rxy += Rx
			Rx += 2
	return [(Rx - Ry)//2, (Rx + Ry)//2 - 1]
```

#### Теорема
Алгоритм всегда завершает работу
Доказательства:
Если $a$ - составное число, то есть $a=bc \ (b \le c)$, тогда
$$
a=bc=(x-y)(x+y)
$$
Поскольку $x-y \le x+y$, положим $b=x-y, c=x+y$. Из этого следует, что
$$
\displaylines{
x=\frac{c+b}{2}\\
y=\frac{c-b}{2}
}
$$
Если $b=c$, то $a$ является квадратом, поэтому алгоритм Ферма закончит своё действие на 1-ом шаге. В случае если $a\ne b$ будем полагать, что
$$
1<b<c<a
$$
Докажем справедливость следующего выражения
$$
h<\frac{c+b}{2}<\frac{a+1}{2}
$$
Сделаем подстановку $a=bc$ и будем рассматривать только правое неравенство
$$
\displaylines{
\frac{c+b}{2}<\frac{bc+1}{2} \Rightarrow\\
\Rightarrow c-1<bc-b\Rightarrow c-1<b(c-1)
}
$$
Поскольку $c>1$, то можно разделить обе части неравенства на $c-1$
$$
b>1
$$
Мы получили корректное утверждение, соответственно правая часть неравенства доказана.
Рассмотрим левую часть неравенства. Можно сделать заключение, что $h\le\sqrt a$, поскольку $h$ - оценка целой части этого корня. Тогда для доказательства левой части неравенства нужно доказать следующее
$$
a \le \frac{(b+c)^2}{4}
$$
Из жонглирования формулами можно прийти к следующему выражению:
$$
\left(\frac{c+b}{2}\right)^2-\left(\frac{c-b}{2}\right)^2=bc=a
$$
Отсюда
$$
\displaylines{
\left(\frac{c+b}{2}\right)^2-a=\left(\frac{c-b}{2}\right)^2\ge0 \Rightarrow\\
\Rightarrow\left(\frac{c+b}{2}\right)^2-a\ge0\Rightarrow\\
\Rightarrow a \le \frac{(b+c)^2}{4}
}
$$
Неравенство доказано.
Для чего оно доказывалось? Нам нужно было понять соотношение между $\frac{c+b}{2}$ и $h, \frac{a+1}{2}$. 
$\frac{c+b}{2}$ - это конечное значение $x$, к которому мы можем прийти. 
$h$ - это начальное значение $x$.
$\frac{a+1}{2}$ - это некоторое постоянное число, которое известно ещё до выполнения алгоритма.
Благодаря этому *"постоянному числу"* мы можем сделать заключение, что как бы мы не увеличивали $x$ мы рано или поздно дойдём до $\frac{b-c}{2}$, ведь мы не можем $x$-ом перепрыгнуть *"постоянное число"*.

Также можно отметить тот факт, что при выбранном определении $b$ и $c$ метод ферма выбирает эти числа таким образом, чтобы разница ниже была минимальной:
$$
\frac{b+c}{2}-h
$$
